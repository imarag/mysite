{% extends 'base.html' %}

{% block title %}
    Python obspy
{% endblock %}


{% block content %}
    <section class="bg-light">
        <div class="py-3 container-lg">
            <div class="row justify-content-center align-items-center  pt-5 mb-4 ">
                <div class="col-lg-2 col-3 col-md-2 d-none d-md-block">
                    <a href="https://docs.obspy.org/">
                        <img src="/static/img/obspy-images/obspy-image-no-bg.png" alt="mseed record ASCII file" class="img-fluid">
                    </a>
                </div>
                <div class="col-lg-9 col-10 col-md-8 text-center text-md-start">
                    <p class="display-1">Python Obspy</p>
                </div>
                    
            </div>

            <div class="fs-2 lead fst-italic text-muted">
                <p class="text-center text-md-start">Obspy is a Python library for seismological data processing. It provides many seismological signal processing functions as well as date and time manipulation.</p>
            </div>


            

            <div class="text-center fs-5 my-5" id="hyper-reference-pills-container">
                <a target="_blank" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.Stream.html"><span class="badge rounded-pill">Stream</span></a>
                <a target="_blank" href="https://docs.obspy.org/packages/autogen/obspy.core.trace.Trace.html"><span class="badge rounded-pill">Trace</span></a>
                <a target="_blank" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.Stream.filter.html"><span class="badge rounded-pill">filter</span></a>
                <a target="_blank" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.read.html"><span class="badge rounded-pill">read</span></a>
                <a target="_blank" href="https://docs.obspy.org/packages/autogen/obspy.core.trace.Stats.html"><span class="badge rounded-pill">stats</span></a>
                <a target="_blank" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html"><span class="badge rounded-pill">ndarray</span></a>
                <a target="_blank" href="https://docs.obspy.org/packages/autogen/obspy.core.trace.Trace.trim.html#obspy.core.trace.Trace.trim"><span class="badge rounded-pill">trim</span></a>
                <a target="_blank" href="https://stackoverflow.com/questions/33845604/what-does-dict-like-mean-in-python"><span class="badge rounded-pill">dict-like</span></a>
            </div>
        </div>
        
    </section>
    
    
    <section>
        <div class="py-3 lead fs-4 container-lg">
            <h1 class="display-5 text-center my-5">Basic structure</h1>
            <p class="justified-paragraph first-line-indent">
                The main structure of the Obspy library consists of the <code>Trace</code> and the <code>Stream</code> objects. The <code>Trace</code> represents
                a single time series record of seismic data recorded at a single station or sensor. It's essentially a single waveform with associated metadata 
                (e.g., station code, sampling frequency, starting time of the recording etc.). 
                The <code>Stream</code> object is a container of one or more <code>Trace</code> objects. Typically, a <code>Stream</code> object, contains three recordings or traces: two with horizontal 
                components (e.g., North-South and East-West) and one with a vertical component and offers several attributes that provide information about the respective recording. For instance, the <code>.data</code> attribute provides the 
                time series data samples and the <code>.stats</code> returns the seismic parameters of the recordings (sampling frequency, number of sample points, etc.). In addition, it provides several methods or functions to 
                manipulate the record. Such methods are the <code>filter()</code> function that filters the recordings between a specific frequency range and the <code>trim()</code> function
                that trims the time series between a specific starting and ending time.
            </p>
            <div class="row justify-content-center align-items-center text-center my-5">
                <div class="col-lg-8 col-md-10 col-12">
                    <figure>
                        <img src="/static/img/obspy-images/obspy-structure.png" alt="mseed record ASCII file" class="img-fluid my-5">
                        <figcaption class="lead fs-5 fst-italic">The structure of the obspy library. A Stream consists of one or more Trace objects which have different methods (.taper(), .filter(), etc.) and attributes (.data, .stats, etc.)</figcaption>
                    </figure>
                </div>
            </div>
            <p class="justified-paragraph first-line-indent">
                Obspy supports several file <a target="_blank" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.read.html">formats</a> to read data. 
                One of the most used seimic file formats is the MiniSEED format. It is a binary file used to store time series data in a compact and 
                efficient format that includes information about the station, location, timing, and the actual waveform data. MiniSEED files are widely
                    used in seismology and are the standard format for sharing and archiving seismic data.
            </p>
    </section>

    <section>
        <div class="py-3 lead fs-4 container-lg">
            <h1 class="display-5 text-center my-5">Obspy Date and Time Manipulation</h1>
            <p class="justified-paragraph first-line-indent">
                Obspy offers extensive support for data and time manipulation. It includes the <code>UTCDateTime</code> object to represent date and time. 
                For instance the start time and the end time of a recording, which are saved as <code>starttime</code> and <code>endtime</code> in the metadata information
                of a <code>Trace</code> object, are both a <code>UTCDateTime</code> data type. Start by initializing the function:
            </p>
            <div class="input-code-block">
                <pre><code><span class="python-color1">from</span> <span class="python-color2">obspy.core</span> <span class="python-color1">import</span> UTCDateTime
                    </code></pre>
            </div>
            <p>
                Create a <code>UTCDateTime</code> object from a Pyton string:
            </p>
            <div class="input-code-block">
                <pre><code><span class="comment"># create a UTCDateTime object from a Python string</span>
                    dt <span class="python-color2">=</span> <span class="python-color1">UTCDateTime</span>(<span class="python-color3">"2012-09-07T12:15:00"</span>)
                    <span class="python-color1">print</span>(dt, <span class="python-color1">type</span>(dt))
                    </code></pre>
            </div>
            <div class="output-code-block">
                <pre><code>2012-09-07T12:15:00.000000Z &lt;class 'obspy.core.utcdatetime.UTCDateTime'&gt;</code></pre>
            </div>
            <p>
                You can perform addition, subtraction and extract multiple attributes from this object using the dot notation:
            </p>
            
            <div class="accordion my-4" id="code1">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code1">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># add 20 seconds</span>
                                dt += 20
                                <span class="python-color1">print</span>(dt)
                                <span class="python-color1">print</span>()
                                <span class="comment"># get some datetime attributes</span>
                                <span class="python-color1">print</span>(<span class="python-color3">"dt.date      -> "</span>, dt.<span class="python-color2">date</span>)
                                <span class="python-color1">print</span>(<span class="python-color3">"dt.time      -> "</span>, dt.<span class="python-color2">time</span>)
                                <span class="python-color1">print</span>(<span class="python-color3">"dt.year      -> "</span>, dt.<span class="python-color2">year</span>)
                                <span class="python-color1">print</span>(<span class="python-color3">"dt.month     -> "</span>, dt.<span class="python-color2">month</span>)
                                <span class="python-color1">print</span>(<span class="python-color3">"dt.day       -> "</span>, dt.<span class="python-color2">day</span>)
                                <span class="python-color1">print</span>(<span class="python-color3">"dt.hour      -> "</span>, dt.<span class="python-color2">hour</span>)
                                <span class="python-color1">print</span>(<span class="python-color3">"dt.minute    -> "</span>, dt.<span class="python-color2">minute</span>)
                                <span class="python-color1">print</span>(<span class="python-color3">"dt.second    -> "</span>, dt.<span class="python-color2">second</span>)
                                <span class="python-color1">print</span>(<span class="python-color3">"dt.timestamp -> "</span>, dt.<span class="python-color2">timestamp</span>)
                                <span class="python-color1">print</span>(<span class="python-color3">"dt.weekday   -> "</span>, dt.<span class="python-color2">weekday</span>)</code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>
            



            <div class="output-code-block">
                <pre><code>2012-09-07T12:15:20.000000Z

                    dt.date      ->  2012-09-07
                    dt.time      ->  12:15:20
                    dt.year      ->  2012
                    dt.month     ->  9
                    dt.day       ->  7
                    dt.hour      ->  12
                    dt.minute    ->  15
                    dt.second    ->  20
                    dt.timestamp ->  1347020120.0
                    dt.weekday   ->  4</code></pre>
            </div>
            

            <p>Last but not least, one can subtract <code>UTCDateTime</code> objects and get the difference of them in seconds:</p>
            <div class="accordion my-4" id="code2">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code2">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># create another UTCDateTime object</span>
                                dt2 = <span class="python-color1">UTCDateTime</span>(<span class="python-color3">"2012-09-07T12:20:00"</span>)
                                <span class="python-color1">print</span>(dt2)
                                <span class="python-color1">print</span>()
                                <span class="comment"># calculate the difference of the two UTCDateTime objects</span>
                                diff = dt2 - dt
                                <span class="python-color1">print</span>(diff)</code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>
            

            <div class="output-code-block">
                <pre><code>2012-09-07T12:20:00.000000Z

                    280.0</code></pre>
            </div>
            <p>
                The <code>starttime</code> and <code>endtime</code> keys in the header information of the recordings need to be in a <code>UTCDateTime</code> data type.  
                Therefore, if you intend to modify these keys within 
                the <code>trace.stats</code> dictionary-like header, convert your datetime string into the 
                <code>UTCDateTime</code> format.

            </p>
        </div>
        </div>
    </section>

    <section>
        <div class="py-3 lead fs-4 container-lg">
            <h1 class="display-5 text-center my-5">Attributes and Methods</h1>
            <p class="justified-paragraph">
                Within ObsPy, you'll find an array of attributes and methods 
                associated with the <code>Trace</code> class for accessing 
                recording information, seismic file handling, and applying 
                waveform processing techniques. To begin with, let's use the Obspy
                <code>read()</code> function for reading seismic 
                files. We'll initiate by importing this function:
            </p>
            <div class="input-code-block">
                <pre><code><span class="python-color1">from</span> <span class="python-color2">obspy.core</span> <span class="python-color1">import</span> read
                </code></pre>
            </div>
            <p>
                To continue, let's read a file of a recording happened on <code>24 July, 2015</code> 
                at <code>09:58:39</code> and recorded by <i>RLN1</i> station:
            </p>
            <div class="accordion my-4" id="code3">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code3">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># read an mseed file</span>
                                st = <span class="python-color1">read</span>(<span class="python-color3">"20150724_095839_RLN1.mseed"</span>)
                                <span class="python-color1">print</span>(st)
                            </code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>
            
            <div class="output-code-block">
                <pre><code>3 Trace(s) in Stream:
                    .KRL1..E | 2015-07-24T09:58:49.000000Z - 2015-07-24T10:01:39.000000Z | 100.0 Hz, 17001 samples
                    .KRL1..N | 2015-07-24T09:58:49.000000Z - 2015-07-24T10:01:39.000000Z | 100.0 Hz, 17001 samples
                    .KRL1..Z | 2015-07-24T09:58:49.000000Z - 2015-07-24T10:01:39.000000Z | 100.0 Hz, 17001 samples</code></pre>
            </div>
            <p>
                The file is a MiniSEED file that contains 3 traces or records 
                each with a different component (E, N, Z). We can see the start 
                and the end time of the record, the sampling frequency in Hz 
                and the total samples. Let's get this information for the first 
                trace of the <code>Stream</code> object:
            </p>
            <div class="accordion my-4" id="code4">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code4">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># get the first trace</span>
                                first_trace = st[0]
                                <span class="comment"># output the header information of that trace object</span>
                                <span class="python-color1">print</span>(first_trace<span class="python-color2">.stats</span>)
                            </code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>
            
            <div class="output-code-block">
                <pre><code>network: 
                    station: KRL1
                   location: 
                    channel: E
                  starttime: 2015-07-24T09:58:49.000000Z
                    endtime: 2015-07-24T10:01:39.000000Z
              sampling_rate: 100.0
                      delta: 0.01
                       npts: 17001
                      calib: 1.0
                    _format: MSEED
                      mseed: AttribDict({'dataquality': 'D', 'number_of_records': 34, 'encoding': 'FLOAT64', 'byteorder': '>', 'record_length': 4096, 'filesize': 417792})</code></pre>
            </div>
            <p>
                We can observe multiple key-value pairs that contain the seismic parameters, such as the station code or name which is <i>KRL1</i>, the component of the record which is East-West (E) and the the sampling frequency or rate 
                of 100 Hz. Several other parameters are also apparent like the starting and the ending time of the record (starttime, endtime), the sample distance in seconds (dt), the total number of sample
                points (npts) and more. The output is a <code>obspy.core.trace.Stats</code> object which is a <code>dict-like</code> object that you can get and set the values. 
            </p>
            <p>In order to check the recordings visually, get the sample data and the time information using the <code>.data</code> and the <code>.times()</code> methods respectively.</p>
            
            <div class="accordion my-4" id="code5">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code5">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># import the matplotlib library </span>
                                <span class="python-color1">import</span> matplotlib.pyplot <span class="python-color2">as</span> plt
            
                                <span class="comment"># Initialize a matplotlib figure and axes with the total</span>
                                <span class="comment"># number of plots equal to the number of traces len(st)</span>
                                fig, ax = plt.<span class="python-color1">subplots</span>(<span class="python-color1">len</span>(st), 1)
            
                                <span class="comment"># Loop through all the traces in the stream object (st)</span>
                                <span class="python-color2">for</span> n, tr <span class="python-color2">in</span> <span class="python-color1">enumerate</span>(st):
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># get the time series time information of the current trace</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;xdata = tr.<span class="python-color1">times</span>()
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># get the data of the current trace</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ydata = tr.<span class="python-color2">data</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># plot the graph with legend, the trace channel</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">plot</span>(xdata, ydata, label=tr<span class="python-color2">.stats.channel</span>)
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># add the legend on the plot</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">legend</span>()
                                    <span class="comment"># adjust the subplots so they do not overlap</span>
                                    plt.<span class="python-color1">tight_layout</span>()
                            </code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>
            
            <div class="row justify-content-center align-items-center text-center my-5">
                <div class="col-lg-8 col-md-10 col-12">
                    <figure>
                        <img src="/static/img/obspy-images/mseed_plot.png" alt="mseed plot" class="img-fluid my-5">
                        <figcaption class="lead fs-5 fst-italic">Recordings or traces of the MiniSEED file with components E, N, Z</figcaption>
                    </figure>
                </div>
            </div>
            <p>
                We could achieve a similar result by just using the <code>.plot()</code> method of the <code>Stream</code> object (st):
            </p>
            <div class="accordion my-4" id="code6">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code6">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code>st.<span class="python-color1">plot</span>()
                            </code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>
            
            <div class="row justify-content-center align-items-center text-center my-5">
                <div class="col-lg-8 col-md-10 col-12">
                    <figure>
                        <img src="/static/img/obspy-images/stream-plot-plot-command.png" alt="mseed plot" class="img-fluid my-5">
                        <figcaption class="lead fs-5 fst-italic">Recordings of the MiniSEED file using the .plot() method</figcaption>
                    </figure>
                </div>
            </div>
            <p>
                This method can get some parameters to control the visualization of the plots such as the color of the waveforms, the size of the plot, the rotation and size of the 
                x axis labels and more. Check all these parameters of the <a target="_blank" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.Stream.plot.html">obspy.core.stream.Stream.plot</a> command.
            </p>
            <p>
                At this point, for the sake of the tutorial, let's assume that we need to calculate the Fourier spectra within a specific window of the signal in the waveforms. To accomplish this, there are several 
                preprocessing steps that need to be applied:
            </p>
            <ol>
                <li>Apply a bandpass filter from 1 to 3 Hz to remove the noise</li>
                <li>Select the arrivals of the P and S waves</li>
                <li>Define a window of 10 seconds to calculate the Fourier Spectra</li>
                <li>Trim the recordings inside that 10-second window</li>
                <li>Taper the waveforms so that they start and end with zero acceleration</li>
            </ol>
            <p>
                Start by applying a bandpass filter to the records from 1 to 3 Hz to remove the surrounding noise and facilitate the arrival selection. 
                Utilize the Obspy <code>filter()</code> function:
            </p>
            <div class="accordion my-4" id="code7">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code7">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># apply an inplace bandpass filter of 1-3 Hz</span>
                                st.<span class="python-color1">filter</span>(<span class="python-color3">'bandpass'</span>, freqmin=1, freqmax=3)
                                <span class="comment"># plot the recordings</span>
                                st.<span class="python-color1">plot</span>()
                            </code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>
            
            <div class="row justify-content-center align-items-center text-center my-5">
                <div class="col-lg-8 col-md-10 col-12">
                    <figure>
                        <img src="/static/img/obspy-images/stream-plot-filtered.png" alt="mseed plot" class="img-fluid my-5">
                        <figcaption class="lead fs-5 fst-italic">Recordings after applying a bandpass filter of 1-3 Hz</figcaption>
                    </figure>
                </div>
            </div>
            <p>
                It's clear from the filtered waveforms, that the P wave arrival occurs roughly at <code>09:59:03</code> and the S wave arrival at <code>09:59:20</code>. 
                To plot the P-wave and S-wave arrivals on the waveforms, you 
                can use Matplotlib to mark these time points with vertical 
                lines. Here's an example of how you can do it in Python:
            </p>

            <div class="accordion my-4" id="code8">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code8">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># Initialize a matplotlib figure and axes with the total</span>
                                <span class="comment"># number of plots equal to the number of traces len(st)</span>
                                fig, ax = plt.<span class="python-color1">subplots</span>(<span class="python-color1">len</span>(st), 1)
            
                                <span class="comment"># Define the P and S wave arrivals as UTCDateTime objects</span>
                                Parr = <span class="python-color1">UTCDateTime(</span><span class="python-color3">'2015-07-24 09:59:03'</span>)
                                Sarr = <span class="python-color1">UTCDateTime(</span><span class="python-color3">'2015-07-24 09:59:20'</span>)
            
                                <span class="comment"># Get the start date of the records from the first trace of the stream object</span>
                                start_date = st[0]<span class="python-color2">.stats.starttime</span>
            
                                <span class="comment"># Calculate the P and S arrivals in seconds from the start date</span>
                                Parr_sec = Parr - start_date
                                Sarr_sec = Sarr - start_date
            
                                <span class="comment"># Loop through all the traces in the stream object (st)</span>
                                <span class="python-color2">for</span> n, tr <span class="python-color2">in</span> <span class="python-color1">enumerate</span>(st):
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># get the time series time information of the current trace</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;xdata = tr<span class="python-color1">.times</span>()
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># get the data of the current trace</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ydata = tr<span class="python-color2">.data</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># plot the graph with legend, the trace channel</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">plot</span>(xdata, ydata, label=tr<span class="python-color2">.stats.channel</span>)
                                    
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># add two vertical lines that represent the arrivals</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">axvline</span>(x=Parr_sec, ymin=0, ymax=1, lw=2, ls=<span class="python-color3">'--'</span>, color=<span class="python-color3">'red'</span>, label=<span class="python-color3">'P arrival'</span>)
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">axvline</span>(x=Sarr_sec, ymin=0, ymax=1, lw=2, ls=<span class="python-color3">'--'</span>, color=<span class="python-color3">'black'</span>, label=<span class="python-color3">'S arrival'</span>)
                                    
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># add the legend on the plot</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">legend</span>(loc=<span class="python-color3">'upper right'</span>)
                                    <span class="comment"># adjust the subplots so they do not overlap</span>
                                    plt.<span class="python-color1">tight_layout</span>()
                            </code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>



            
            <div class="row justify-content-center align-items-center text-center my-5">
                <div class="col-lg-8 col-md-10 col-12">
                    <figure>
                        <img src="/static/img/obspy-images/arrivals.png" alt="mseed plot" class="img-fluid my-5">
                        <figcaption class="lead fs-5 fst-italic">Arrivals of the P (red dashed line) and the S (black dashed line) waves</figcaption>
                    </figure>
                </div>
            </div>
            <p>
                At this stage we define two windows to calculate the Fourier Spectra, one for the signal part of the waveform and one for the noise part.
                Both windows will share the same duration or length of 10 seconds. The first window 
                will start from the S wave arrival and the second one will begin 10 seconds before the P wave arrival. Let's visualize these windows: 
            </p>

            <div class="accordion my-4" id="code9">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code9">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># Initialize a matplotlib figure and axes with the total</span>
                                <span class="comment"># number of plots equal to the number of traces len(st)</span>
                                fig, ax = plt.<span class="python-color1">subplots</span>(<span class="python-color1">len</span>(st), 1)
            
                                <span class="comment"># Define the P and S wave arrivals as UTCDateTime objects</span>
                                Parr = <span class="python-color1">UTCDateTime(</span><span class="python-color3">'2015-07-24 09:59:03'</span>)
                                Sarr = <span class="python-color1">UTCDateTime(</span><span class="python-color3">'2015-07-24 09:59:20'</span>)
            
                                <span class="comment"># Get the start date of the records from the first trace of the stream object</span>
                                start_date = st[0]<span class="python-color2">.stats.starttime</span>
            
                                <span class="comment"># Calculate the P and S arrivals in seconds from the start date</span>
                                Parr_sec = Parr - start_date
                                Sarr_sec = Sarr - start_date
            
                                <span class="comment"># initialize the window length</span>
                                window_length = 10
            
                                <span class="comment"># Loop through all the traces in the stream object (st)</span>
                                <span class="python-color2">for</span> n, tr <span class="python-color2">in</span> <span class="python-color1">enumerate</span>(st):
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># get the time series time information of the current trace</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;xdata = tr<span class="python-color1">.times</span>()
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># get the data of the current trace</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ydata = tr<span class="python-color2">.data</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># plot the graph with legend, the trace channel</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">plot</span>(xdata, ydata, label=tr<span class="python-color2">.stats.channel</span>)
                                
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># add two vertical lines that represent the arrivals</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">axvline</span>(x=Parr_sec, ymin=0, ymax=1, lw=2, ls=<span class="python-color3">'--'</span>, color=<span class="python-color3">'red'</span>, label=<span class="python-color3">'P arrival'</span>)
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">axvline</span>(x=Sarr_sec, ymin=0, ymax=1, lw=2, ls=<span class="python-color3">'--'</span>, color=<span class="python-color3">'black'</span>, label=<span class="python-color3">'S arrival'</span>)
                                    
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># create the signal and the noise window on the waveforms</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">fill_betweenx</span>([-0.08,0.08], x1=Sarr_sec, x2=Sarr_sec+window_length, alpha=0.5, facecolor=<span class="python-color3">'orange'</span>, zorder=2, label=<span class="python-color3">'signal window'</span>)
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">fill_betweenx</span>([-0.08,0.08], x1=Parr_sec-window_length, x2=Parr_sec, alpha=0.5, facecolor=<span class="python-color3">'red'</span>, zorder=2, label=<span class="python-color3">'noise window'</span>)
            
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># add the legend on the plot</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">legend</span>(loc=<span class="python-color3">'upper right'</span>)
                                    <span class="comment"># adjust the subplots so they do not overlap</span>
                                    plt.<span class="python-color1">tight_layout</span>()
                            </code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>


            
            <div class="row justify-content-center align-items-center text-center my-5">
                <div class="col-lg-8 col-md-10 col-12">
                    <figure>
                        <img src="/static/img/obspy-images/windows.png" alt="mseed plot" class="img-fluid my-5">
                        <figcaption class="lead fs-5 fst-italic">Create two windows to calculate the Fourier Spectra, one at the signal part of the waveform and the other at the noise part. Both will have a duration of 10 seconds. The first starts at the S wave arrival and the second 10 seconds before the P arrival.</figcaption>
                    </figure>
                </div>
            </div>
            <p>
                To continue, trim the waveforms at the two windows using the Obspy <code>trim()</code> function. Here's how you can do it in Python:
            </p>

            <div class="accordion my-4" id="code10">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code10">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># Initialize a matplotlib figure and axes with the total</span>
                                <span class="comment"># number of plots equal to the number of traces plus 3</span>
                                <span class="comment"># a signal and a noise part for each trace (3) </span>
                                fig, ax = plt.<span class="python-color1">subplots</span>(<span class="python-color1">len</span>(st)+3, 1, figsize=(8,10))
            
                                <span class="comment"># Define the P and S wave arrivals as UTCDateTime objects</span>
                                Parr = <span class="python-color1">UTCDateTime(</span><span class="python-color3">'2015-07-24 09:59:03'</span>)
                                Sarr = <span class="python-color1">UTCDateTime(</span><span class="python-color3">'2015-07-24 09:59:20'</span>)
            
                                <span class="comment"># Get the start date of the records from the first trace of the stream object</span>
                                start_date = st[0]<span class="python-color2">.stats.starttime</span>
            
                                <span class="comment"># Calculate the P and S arrivals in seconds from the start date</span>
                                Parr_sec = Parr - start_date
                                Sarr_sec = Sarr - start_date
            
                                <span class="comment"># initialize the window length</span>
                                window_length = 10
            
                                <span class="comment"># trim the waveforms at the respective windows</span>
                                <span class="comment"># noise window: from Parr - window_length to Parr</span>
                                <span class="comment"># signal window: from Sarr to Sarr + window_length</span>
                                <span class="comment"># Since the trim() function happens inplace, create new streams</span>
                                <span class="comment"># using the copy() function to trim the traces separately</span>
                                st_signal = st.<span class="python-color2">copy</span>().<span class="python-color1">trim</span>(starttime=start_date+Sarr_sec, endtime=start_date+Sarr_sec+window_length)
                                st_noise = st.<span class="python-color2">copy</span>().<span class="python-color1">trim</span>(starttime=start_date+Parr_sec-window_length, endtime=start_date+Parr_sec)
            
                                <span class="comment"># Loop through all the traces in the noise Stream</span>
                                <span class="comment"># and plot them in the first 3 plots for each trace</span>
                                <span class="python-color2">for</span> n, tr_noise <span class="python-color2">in</span> <span class="python-color1">enumerate</span>(st_noise):
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># get the time series time information of the current trace</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;xdata = tr_noise<span class="python-color1">.times</span>()
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># get the data of the current trace</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ydata = tr_noise<span class="python-color2">.data</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># plot the graph</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">plot</span>(xdata, ydata, label=f<span class="python-color3">'noise window, channel: {tr_noise.stats.channel}'</span>)
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">legend</span>(loc=<span class="python-color3">'upper left'</span>)
                                
                                <span class="comment"># Loop through all the traces in the signal Stream</span>
                                <span class="comment"># and plot them in the next 3 plots for each trace</span>
                                <span class="python-color2">for</span> n, tr_signal <span class="python-color2">in</span> <span class="python-color1">enumerate</span>(st_signal, start=3):
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># get the time series time information of the current trace</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;xdata = tr_signal<span class="python-color1">.times</span>()
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># get the data of the current trace</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ydata = tr_signal<span class="python-color2">.data</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># plot the graph</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">plot</span>(xdata, ydata, label=f<span class="python-color3">'signal window, channel: {tr_signal.stats.channel}'</span>)
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[n].<span class="python-color1">legend</span>(loc=<span class="python-color3">'upper left'</span>)
            
                                    <span class="comment"># adjust the subplots so they do not overlap</span>
                                    plt.<span class="python-color1">tight_layout</span>()
                            </code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>


            
            <div class="row justify-content-center align-items-center text-center my-5">
                <div class="col-lg-8 col-md-10 col-12">
                    <figure>
                        <img src="/static/img/obspy-images/trimmed.png" alt="mseed plot" class="img-fluid my-5">
                        <figcaption class="lead fs-5 fst-italic">Trimmed waveforms at the noise and the signal windows for all the components</figcaption>
                    </figure>
                </div>
            </div>
            <p>
                Lastly, taper the waveforms, in order to smooth the left and the right side of the waveforms, using the obspy <code>taper()</code> function:
            </p>

            <div class="accordion my-4" id="code11">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code11">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># Initialize a matplotlib figure and axes with the total</span>
                                <span class="comment"># number of plots equal to the number of traces plus 3</span>
                                <span class="comment"># a signal and a noise part for each trace (3) </span>                                
                                fig, ax = plt.<span class="python-color1">subplots</span>(<span class="python-color1">len</span>(st)+3, 1, figsize=(8,10))
            
                                <span class="comment"># Define the P and S wave arrivals as UTCDateTime objects</span>
                                Parr = <span class="python-color1">UTCDateTime(</span><span class="python-color3">'2015-07-24 09:59:03'</span>)
                                Sarr = <span class="python-color1">UTCDateTime(</span><span class="python-color3">'2015-07-24 09:59:20'</span>)
            
                                <span class="comment"># Get the start date of the records from the first trace of the stream object</span>
                                start_date = st[0]<span class="python-color2">.stats.starttime</span>
            
                                <span class="comment"># Calculate the P and S arrivals in seconds from the start date</span>
                                Parr_sec = Parr - start_date
                                Sarr_sec = Sarr - start_date
            
                                <span class="comment"># initialize the window length</span>
                                window_length = 10
            
                                <span class="comment"># trim the waveforms at the respective windows</span>
                                <span class="comment"># noise window: Parr - window_length to Parr</span>
                                <span class="comment"># signal window: Sarr to Sarr + window_length</span>
                                st_signal = st.<span class="python-color1">copy</span>().<span class="python-color1">trim</span>(starttime=start_date+Sarr_sec, endtime=start_date+Sarr_sec+window_length)
                                st_noise = st.<span class="python-color1">copy</span>().<span class="python-color1">trim</span>(starttime=start_date+Parr_sec-window_length, endtime=start_date+Parr_sec)
            
                                <span class="comment"># taper the waveforms at the respective windows 30% on the left and 30% on the right side</span>
                                <span class="comment"># again use the copy() function to apply the taper on new stream object</span>
                                st_signal_taper = st_signal<span class="python-color2">.copy</span>()<span class="python-color1">.taper</span>(side=<span class="python-color3">'both'</span>, max_percentage=0.3)
                                st_noise_taper = st_noise<span class="python-color2">.copy</span>()<span class="python-color1">.taper</span>(side=<span class="python-color3">'both'</span>, max_percentage=0.3)
            
                                <span class="comment"># Loop through the number of traces in the noise Stream</span>
                                <span class="python-color2">for</span> i <span class="python-color2">in</span> <span class="python-color1">range</span>(<span class="python-color1">len</span></span>(st_noise)):
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># plot the trimmed waveforms with blue color</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[i].<span class="python-color1">plot</span>(st_noise[i]<span class="python-color1">.times</span>(), st_noise[i]<span class="python-color2">.data</span>, label=f'trimmed noise window, channel: {st_noise[i]<span class="python-color2">.stats.channel</span>}', color=<span class="python-color3">"blue"</span>)
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># plot the tappered waveforms with orange color</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[i].<span class="python-color1">plot</span>(st_noise_taper[i]<span class="python-color1">.times</span>(), st_noise_taper[i]<span class="python-color2">.data</span>, label=f<span class="python-color3">'tapered'</span>, lw=3, color=<span class="python-color3">"orange"</span>)
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[i].<span class="python-color1">legend</span>(loc=<span class="python-color3">'upper center'</span>)
                                    
                                <span class="comment"># Loop through the number of traces in the signal Stream</span>
                                <span class="python-color2">for</span> i <span class="python-color2">in</span> <span class="python-color1">range</span>(<span class="python-color1">len</span></span>(st_signal)):
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># plot the trimmed waveforms with blue color</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[i+3].<span class="python-color1">plot</span>(st_signal[i]<span class="python-color1">.times</span>(), st_signal[i]<span class="python-color2">.data</span>, label=f'trimmed signal window, channel: {st_signal[i]<span class="python-color2">.stats.channel</span>}', color=<span class="python-color3">"blue"</span>)
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># plot the tappered waveforms with orange color</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[i+3].<span class="python-color1">plot</span>(st_signal_taper[i]<span class="python-color1">.times</span>(), st_signal_taper[i]<span class="python-color2">.data</span>, label=f<span class="python-color3">'tapered'</span>, lw=3, color=<span class="python-color3">"orange"</span>)
                                    &nbsp;&nbsp;&nbsp;&nbsp;ax[i+3].<span class="python-color1">legend</span>(loc=<span class="python-color3">'upper center'</span>)
            
                                    <span class="comment"># adjust the subplots so they do not overlap</span>
                                    plt.<span class="python-color1">tight_layout</span>()
                            </code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>


            
            
            <div class="row justify-content-center align-items-center text-center my-5">
                <div class="col-lg-8 col-md-10 col-12">
                    <figure>
                        <img src="/static/img/obspy-images/taper.png" alt="mseed plot" class="img-fluid my-5">
                        <figcaption class="lead fs-5 fst-italic">Trimmed (blue) and tappered (orange) waveforms at the noise and the signal window for all the components</figcaption>
                    </figure>
                </div>
            </div>
            <p>
                Finally we can calculate the Fourier Spectra at the noise and the signal window on the waveforms. 
                To save the final tappered and/or trimmed <code>Stream</code> objects, utilize the Obspy <code>write()</code> function to write the seismic data from a Stream object to a file in 
                various supported formats. It allows you to save the seismic data, including metadata, to a file for further analysis or sharing with others.
            </p>
            <div class="accordion my-4" id="code12">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code12">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># write the tappered and the trimmed noise and signal stream object into a MiniSEED file</span>
                                st_signal_taper<span class="python-color1">.write</span>(<span class="python-color3">"tappered_signal_waveform.mseed"</span>)
                                st_noise_taper<span class="python-color1">.write</span>(<span class="python-color3">"tappered_noise_waveform.mseed"</span>)
                                </code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>
            
            <p class="justified-paragraph first-line-indent">
                In this section we have explored several attributes and methods of the Obspy <code>Trace</code> object,
                including the <code>read</code> and <code>write</code> methods to upload and save seismic files, the <code>.data</code> 
                and <code>.stats</code> attributes to extract information about the recordings, 
                the <code>trim()</code>, <code>taper()</code> and <code>filter()</code> functions to manipulate the traces and the 
                <code>plot()</code> function to plot the recordings. Obspy offers
                a wide range of additional attributes and methods for working with seismic data at the 
                <a target="_blank" href="https://docs.obspy.org/packages/autogen/obspy.core.trace.Trace.html">Trace</a> object
                documentation.
            </p>


    </section>

    <section>
        <div class="py-3 lead fs-4 container-lg">
            <h1 class="display-5 text-center my-5">Generating Trace and Stream objects from data</h1>
            <p class="justified-paragraph first-line-indent">
                In addition to reading seismological file formats, you have the flexibility to create your own <code>Trace</code> and <code>Stream</code> objects using ObsPy's 
                <code>obspy.core.trace.Trace</code> and <code>obspy.core.stream.Stream</code> classes. To create a <code>Trace</code> object, begin by 
                supplying the data values of the recording (e.g., acceleration) as a NumPy ndarray to the <code>data</code> parameter within 
                <code>obspy.core.trace.Trace</code>, and include the recording's metadata in a Python dictionary provided to the <code>header</code> parameter. 
                For each trace you wish to create, repeat this process. Then, gather all the <code>Trace</code> objects into a Python list and pass it into the  
                <code>traces</code> parameter in the <code>obspy.core.stream.Stream</code> class to construct a <code>Stream</code> object.
            </p>

            <p>
                Below is presented  a seismic recording from the <i>LEF2</i> station, containing data from three channels (E, N, Z). This data file includes metadata 
                information positioned at the file's header, followed by data for each component. Our goal is to read this file and assemble a <code>Stream</code> 
                object comprising three individual traces.
            </p>

            <div class="row text-center justify-content-center align-items-center my-5">
                <div class="col-lg-8 col-md-10 col-12">
                    <figure>
                        <img src="/static/img/obspy-images/record-txt-file.png" alt="mseed record ASCII file" class="img-fluid my-5">
                        <figcaption class="lead fs-5 fst-italic">Acceleration data in raw ASCII format. The first lines contain the record metadata and the rest of the lines the acceleration data of the three components</figcaption>
                    </figure>
                    
                </div>
            </div>

            <p>
                Start by reading the file and collecting the file header information in order to build a dictionary of the seismic parameters. Then extract the acceleration values 
                of the recording and transform them into a numpy <code>ndarray</code> form. Lastly, create one <code>Trace</code> for each recording and then a 
                <code>Stream</code> object from the traces.
            </p>

            <div class="accordion my-4" id="code13">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code13">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># open the file and read its metadata</span>
                                <span class="python-color2">with</span> <span class="python-color1">open</span>(<span class="python-color3">'20140207-085940-LEF2-data.txt'</span>) <span class="python-color2">as</span> fr:
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># skip the first line</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fr.<span class="python-color1">readline</span>()
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># read the station name</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;station = fr.<span class="python-color1">readline</span>()<span class="python-color1">.split</span>(<span class="python-color3">':'</span>)</span>[1]</span>.<span class="python-color1">strip</span>()
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># read the starting date of the record</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dt_start = fr.<span class="python-color1">readline</span>()<span class="python-color1">.split</span>(<span class="python-color3">':'</span>, 1)[1].<span class="python-color1">strip</span>()
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># read the sampling frequency in Hz</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fs =  fr.<span class="python-color1">readline</span>()<span class="python-color1">.split</span>(<span class="python-color3">':'</span>)</span>[1].<span class="python-color1">strip</span>(<span class="python-color3">' Hz\n'</span>)
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># read the number of sample points</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npts = fr.<span class="python-color1">readline</span>()<span class="python-color1">.split</span>(<span class="python-color3">':'</span>)</span>[1].<span class="python-color1">strip</span>()
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># skip 2 lines</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fr.<span class="python-color1">readline</span>()
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fr.<span class="python-color1">readline</span>()
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># read the components</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;compos = fr.<span class="python-color1">readline</span>()<span class="python-color1">.split</span>(<span class="python-color3">':'</span>)[1].<span class="python-color1">split</span>()
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># show all the parameters that we read from the header of the file</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="python-color1">print(</span>station, dt_start, fs, npts, compos<span class="python-color1">)</span></code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>
            


            <div class="output-code-block">
                <pre><code>LEF2 2014-02-07T08:59:40.000000Z 100.0 18100 ['E', 'N', 'Z']</code></pre>
            </div>

            <p>
                Before we add the metadata into the dictionary, we convert the number of points (npts) into a Ptyhon <code>int</code> datatype, the
                sampling frequency (fs) into a <code>float</code> datatype and the start time of the record (<code>starttime</code>) into a <code>UTCDateTime</code> object.
                Also it is important for the keys of the dictionary, to be one of the options provided in the <a target="_blank" href="https://docs.obspy.org/packages/autogen/obspy.core.trace.Stats.html"><code>obspy.core.trace.Stats</code> </a> object.
            </p>

            <p>
                Then we use the python Pandas library to read the data of the record:
            </p>

            
            <div class="accordion my-4" id="code14">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code14">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># use the Pandas read-csv method to read the data from text file</span>
                                df_data = pd<span class="python-color1">.read_csv(</span><span class="python-color3">'20140207-085940-LEF2-data.txt'</span>, skiprows=10, sep=<span class="python-color3">'\s+'</span>, header=None)
                                <span class="comment"># assign the previous components list into the columns</span>
                                df_data<span class="python-color2">.columns</span> = compos
                                <span class="python-color1">print</span>(df_data)</code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>

          

            <p>
                At this time we have the metadata and the data of the traces. Using these two parameters, we can create the <code>Trace</code> objects. To do this, loop trough the components, create a header dictionary file for each <code>Trace</code> and add its data:
            </p>

            <div class="accordion my-4" id="code15">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code15">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># create an empty list to append each trace object</span>
                                lt_traces = []
                                <span class="comment"># then create a trace for each component</span>
                                <span class="python-color2">for</span> compo <span class="python-color2">in</span> compos:
                                <span class="comment indent"># create a dictionary object and add there the metadata</span>
                                <span class="indent">dict_header = {}</span>
                                <span class="indent">dict_header[<span class="python-color3">"station"</span>] = station</span>
                                <span class="indent">dict_header[<span class="python-color3">"npts"</span>] = <span class="python-color1">int</span>(npts)
                                <span class="indent">dict_header[<span class="python-color3">"sampling_rate"</span>] = float(fs)</span>
                                <span class="indent">dict_header[<span class="python-color3">"starttime"</span>] = <span class="python-color1">UTCDateTime</span>(dt_start)
                                <span class="indent">dict_header[<span class="python-color3">"channel"</span>] = compo</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># create the trace object</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;tr = <span class="python-color1">Trace</span>(data=df_data[compo]<span class="python-color1">.to_numpy</span>(), header=dict_header)
                                &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment"># append the trace into the traces list</span>
                                &nbsp;&nbsp;&nbsp;&nbsp;lt_traces.<span class="python-color1">append</span>(tr)
                                <span class="python-color1">print</span>(lt_traces)</code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>
            
            

            <div class="output-code-block">
                <pre><code>[
                     &lt;obspy.core.trace.Trace object at 0x0000020E0EFB25F0>, 
                     &lt;obspy.core.trace.Trace object at 0x0000020E0F501FC0>, 
                     &lt;obspy.core.trace.Trace object at 0x0000020E0F502890>
                ]</code></pre>
            </div>



            <p>Finally, create the <code>Stream</code> object, from the list of the traces:</p>

            <div class="accordion my-4" id="code16">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      Python script
                    </button>
                  </h2>
                  <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#code16">
                    <div class="accordion-body">
                        <div class="input-code-block">
                            <pre><code><span class="comment"># create the stream by inserting the list of traces into the obspy.core.stream.Stream class</span>
                            st = <span class="python-color1">Stream</span>(lt_traces)
                            <span class="python-color1">print</span>(st)</code></pre>
                        </div>
                    </div>
                  </div>
                </div>
            </div>
            

            <div class="output-code-block">
                <pre><code>3 Trace(s) in Stream:
                    .LEF2..E | 2014-02-07T08:59:40.000000Z - 2014-02-07T09:02:40.990000Z | 100.0 Hz, 18100 samples
                    .LEF2..N | 2014-02-07T08:59:40.000000Z - 2014-02-07T09:02:40.990000Z | 100.0 Hz, 18100 samples
                    .LEF2..Z | 2014-02-07T08:59:40.000000Z - 2014-02-07T09:02:40.990000Z | 100.0 Hz, 18100 samples</code></pre>
            </div>

        </div>
    </section>
    


{% endblock %}


