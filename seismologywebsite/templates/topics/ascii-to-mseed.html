{% extends 'base.html' %}

{% block title %}
    Ascii to mseed
{% endblock %}



{% block content %}

<section class="py-5 bg-light-blue1">
    <div class="row justify-content-around align-items-center gy-4">
        <div class="col-11 col-md-8 col-lg-6">
            <h1 class="display-3 text-center text-dark fw-semibold ">ASCII to MSEED</h1>
            <p class="text-dark text-center fs-2">Convert raw ASCII data to seismic waveform binary data</p>
        </div>
    </div>
    <div class="row justify-content-around align-items-center gy-4">
        <div class="col-5 col-sm-4 col-md-3 col-lg-2 text-center">
            <img src="{{ url_for('static', filename='img/templates-icons/signal-processing-icon.png') }}" alt="image of distance calculator template" class="img-fluid">
        </div>
    </div>
</section>


<section>
    <div class="fs-4 lead container-lg my-5">
        <div class="row justify-content-center">
            <div class="col-11 col-md-9 col-lg-8">
                <p class="text-muted text-start my-5">
                    Utilize this tool for the conversion of ASCII format data files into MiniSEED seismic data files. Start by specifying the input file characteristics to accurately 
                    upload your ASCII file. Then, configure the seismic parameters, which include the station name responsible for recording the seismogram, the sampling frequency, 
                    the waveform's starting time, and additional settings as needed.
                </p>
                <div class="accordion" id="accordionExample">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                User Guide
                            </button>
                        </h2>
                        <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                            <div class="accordion-body">
                                <p class="text-start">
                                    If you have ASCII files that you would like to use with our tools, we offer a convenient 
                                    conversion tool that allows you to convert ASCII files to the MSEED file format which ensures 
                                    compatibility with our interactive tools.
                                    This tool supports only ASCII files and more specifically the formats: <kbd>.csv</kbd>, <kbd>.txt</kbd> and <kbd>.dat</kbd> files. 
                                    Start by selecting the appropriate file parsing parameters that fit with your file format (delimiter, number of rows to read, etc.) and load your data file. 
                                    To continue, when you load the file, check the first five rows that the program reads, at the sample table shown below the file parsing parameters.
                                    If it represents correctly you data columns, continue with the second set of parameters that are related to the sampling process of converting analog signals 
                                    to digital form (sampling frequency, station name, etc.). Lastly, convert your loaded ascii file to mseed.
                                </p>
                                <p class="mt-4">
                                    According to the first five rows that the program shows, in order for you to check if it has correctly read your file, you will see a table (after you load your file, below) with data 
                                    columns. This table is in the form of a <a target="_blank" href="{{ url_for('static', filename='img/ascii-to-mseed-images/pandas-data-structure.svg') }}">Pandas DataFrame</a> table. 
                                    The left most column (with bold numbers) is the index and it is given a default array of numbers from 0 to the total number of rows. You don't need to worry about it. It will not be 
                                    included in the conversion.
                                    If you don't have any header in your file, the column names (the bolded row at the top) are also given a default value from 0 to the total number of your columns. Again your do not have to 
                                    worry about it.
                                </p>
                                <p>
                                    Take into account the following:<br>
                                    <ul>
                                        <li>Be careful of the delimiter. Select the delimiter of your columns correctly in order for the program to run. Use the "space" option if your columns are separated by one or more 
                                            blanks or spaces. </li>
                                        <li>If you skip too many rows at the "skiprows" entry, the final dataframe will be empty and it will give you an error!</li>
                                        <li>Similarly, if you insert the number "0" at the "# rows to read" option, it will result in an error for the same reason.</li>
                                        <li>If your file has 1 or no columns you can't use it. You need at least 2 and at most, 3 columns to use the program. If you have more than 3 columns, use the "columns to read" option to specify 2 or 3 columns to insert. You can't upload more!</li>
                                        <li>If you file has headers and you don't check the "has headers" option it will give you an error.</li>
                                        <li>The "channels" option at the seismic parameter option, need to have one vertical component (Z) and at least one horizontal component (E and/or N). If you provide 3 columns of data each column corresponds to one vertical (Z) and two horizontals (E and N). If you provide the same channel for a column or if you don't include the vertical component (Z) it will give you an error.</li>
                                        <li>The "channels" and "fs/dt" options are obligatory to fill!</li>
                                    </ul>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
    
                <p class="text-muted text-center mt-5 fs-5">
                    Don't have an seismic data file ? Click <a href="{{ url_for('show_topic', topic_name='ascii-to-mseed.html') }}"
                        class="link-info">here</a> to create a MiniSEED file format using data defined in an ASCII file
                    or <a href="{{ url_for('static', filename='static-files/test-mseed-file.mseed') }}"
                        class="link-info">download</a> one, to try the tool.
                </p>
            </div>
        </div>
    </div>
</section>

        
<section>
    <div class="bg-secondary py-4">
        <div class="fs-4  py-4 container-lg">
            <fieldset class="border mb-4 p-4 bg-dark text-secondary rounded">
                <legend class="text-center fs-2">File parsing parameters</legend>
                <hr class="mb-5 mt-3 border-bottom border-secondary border-1">
                <div class="row justify-content-center align-items-center">
                    <div class="col-lg-4 col-md-5 col-6 text-center text-md-start"  style="position: relative;">
                        <div class="my-4">
                            <label for="delimiter-select" class="form-label">delimiter 
                                <button 
                                    style="position: absolute; right:0px;" 
                                    type="button" 
                                    class="btn btn-warning ms-2 btn-sm text-dark" 
                                    data-bs-toggle="popover" 
                                    data-bs-placement="right" 
                                    data-bs-custom-class="custom-popover" 
                                    data-bs-title="Delimiter" 
                                    data-bs-content=
                                        "The data columns are separated by a separator. Use this option to define the separator of the columns. For example, the 
                                        separator of .csv files is the comma (,) separator, which is also the default value. Use the <space> option for a 
                                        single or multiple spaces (or blanks) between the columns"
                                    >?
                                </button>
                            </label>
                            </br>
                            <select id="delimiter-select" name="delimiter" class="form-select" aria-label="Default select">
                                <option value="," name="comma" selected>Comma (,)</option>
                                <option value="\t" name="tab" >Tab (\t)</option>
                                <option value=";" name="semicolon">Semicolon (;)</option>
                                <option value="|" name="pipe">Pipe (|)</option>
                                <option value=":" name="colon">Colon (:)</option>
                                <option value="\s+" name="space">Space</option>
                            </select>
                        </div>
                    </div>
                </div> 
                
                <div class="row justify-content-center align-items-center">
                    <div class="col-lg-4 col-md-5 col-6 text-center text-md-start"  style="position: relative;">
                        <div class="my-4">
                            <label for="skiprows-input" class="form-label">skiprows 
                                <button 
                                    style="position: absolute; right:0px;" 
                                    type="button" 
                                    class="btn btn-warning ms-2 btn-sm text-dark" 
                                    data-bs-toggle="popover" 
                                    data-bs-placement="right" 
                                    data-bs-custom-class="custom-popover" 
                                    data-bs-title="Skip rows" 
                                    data-bs-content=
                                        "Use this option to skip a number of rows before you read the file. This can be used in case you have some information 
                                        in the first few rows in your file that you don't want to be included. The default value is zero (0) that is, don't skip 
                                        any rows. If empty, it is considered as zero (0). If you try to skip more rows that your file has, it will give you 
                                        an error. If both <# of rows to read> and <skiprows> have values filled in, the 
                                        <skiprows> is going to be applied first and then the <# of rows to read>. For instance, if you define
                                        <# of rows to read> to be 10 and the <skiprows> to be 2, then first the program will skip 2 rows and
                                        then it will read the 10 lines."
                                    >?
                                </button>
                            </label>
                            </br>
                            <input type="number" class="form-control" id="skiprows-input" name="skiprows-input" min="0" step="1" value="0" pattern="^ *[0-9]* *$">
                        </div>
                    </div>
                </div> 
                
                <div class="row justify-content-center align-items-center">
                    <div class="col-lg-4 col-md-5 col-6 text-center text-md-start"  style="position: relative;">
                        <div class="my-4">
                            <label for="number-of-rows-to-read-input" class="form-label"># rows to read 
                                <button 
                                    style="position: absolute; right:0px;" 
                                    type="button" 
                                    class="btn btn-warning ms-2 btn-sm text-dark" 
                                    data-bs-toggle="popover" 
                                    data-bs-placement="right" 
                                    data-bs-custom-class="custom-popover" 
                                    data-bs-title="Number of rows to read" 
                                    data-bs-content=
                                        "Insert the total number of rows that you want the program to read. If empty, it is going to read 
                                        all of the rows in your file. If both <# of rows to read> and <skiprows> have values filled in, the 
                                        <skiprows> is going to be applied first and then the <# of rows to read>. For instance, if you define
                                        <# of rows to read> to be 10 and the <skiprows> to be 2, then first the program will skip 2 rows and
                                        then it will read the 10 lines."
                                    >?
                                </button>
                            </label>
                            </br>
                            <input type="number" class="form-control" id="number-of-rows-to-read-input" name="number-of-rows-to-read-input" min="0" step="1" pattern="^ *[0-9]* *$">
                        </div>
                    </div>
                </div> 
                
                <div class="row justify-content-center align-items-center">
                    <div class="col-lg-4 col-md-5 col-6 text-center text-md-start"  style="position: relative;">
                        <div class="my-4">
                            <label for="columns-to-read-input" class="form-label">columns to read 
                                <button 
                                    style="position: absolute; right:0px;" 
                                    type="button" 
                                    class="btn btn-warning ms-2 btn-sm text-dark" 
                                    data-bs-toggle="popover" 
                                    data-bs-placement="right" 
                                    data-bs-custom-class="custom-popover" 
                                    data-bs-title="columns to read" 
                                    data-bs-content=
                                        "Select specific columns from your file to upload. To specify the columns, use numbers from 1 to the 
                                        total length of your columns separated by commas. For example to upload just the first, third and forth 
                                        columns, insert '1,3,4' without the quotes. If empty, it will read all of the columns from your file. You can 
                                        only upload two or three columns. This is because you can have one vertical component and one or two 
                                        horizontal compoments. Thus, if you try to insert more that 3 or less than 2, it won't work!"
                                    >?
                                </button>
                            </label>
                            </br>
                            <input type="text" class="form-control" id="columns-to-read-input" placeholder="e.g. 1,3 or 1,3,4" pattern="^[1-9] *, *[1-9] *,? *[1-9]?$">
                        </div>
                    </div>
                </div>

                
                
                <div class="row justify-content-center align-items-center">
                    <div class="col-lg-4 col-md-5 col-6 text-center text-md-start"  style="position: relative;">
                        <div class="my-4">
                            <input class="form-check-input" type="checkbox" id="has-headers-checkbox" checked>
                            <label for="has-headers-checkbox" class="form-label">has headers 
                                <button 
                                    style="position: absolute; right:0px;" 
                                    type="button" 
                                    class="btn btn-warning ms-2 btn-sm text-dark" 
                                    data-bs-toggle="popover" 
                                    data-bs-placement="right" 
                                    data-bs-custom-class="custom-popover" 
                                    data-bs-title="Has headers" 
                                    data-bs-content=
                                        "Select this option if you file has headers. This option is applied after the application of the rest of the options. 
                                        For example if you skip some rows from your file, then the new first row is considered as the header. If this new first row 
                                        is a header, check the box, else uncheck it."
                                    >?
                                </button>
                            </label>
                        </div>
                    </div>
                </div> 

                <div class="row justify-content-center align-items-center">
                    <div class="text-center  bg-red text-red mt-3" id="spinner-div">
                        <div class="spinner-border spinner-border-xl text-warning" role="status">
                        <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <div class="col-lg-8 col-12 text-center text-md-start">
                        <p class="form-label mt-5 text-center">Upload an ASCII file</p>
                        <input class="form-control d-none" type="file" name="file" id="upload-file-input" accept=".csv, .txt, .dat">
                        <div class="text-center">
                            <button class="btn btn-primary text-center" id="upload-file-button">Upload</button>
                        </div>
                        <p id="uploaded-file-url" class="text-secondary fs-5 text-center mt-5"></p>
                    </div>
                </div>
                

                <div class="row justify-content-center align-items-center my-3">
                    <div class="col-8 text-center">
                        <p class="fs-5">
                            For more information about these options click 
                            <a target="_blank"  href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html" class="text-center link-info">here</a>
                            for the Pandas <code>read_csv</code> function or 
                            <a target="_blank" href="{{ url_for('static', filename='img/ascii-to-mseed-images/ascii-manual.png') }}" class="link-info">here</a>
                            to view the steps visually.
                        </p>
                    </div>
                </div>

                

                <div class="row mt-5 justify-content-center">
                    <div class="col-auto text-center" >
                        <div id="table-container-preview">

                        </div>
                    </div>
                </div>
                
            </fieldset>
        

            <fieldset class="border mb-4 p-4 bg-dark text-secondary rounded" id="submit-form-fieldset" disabled>
                <legend class="text-center fs-2">Seismic parameters options</legend>
                <hr class="mb-5 mt-3 border-bottom border-secondary border-1">
                <div class="row align-items-center justify-content-start gy-2 fs-5">                            
                    <div class="col-lg-3 col-6 text-start">
                        <label for="date">
                            <button  
                                type="button" 
                                class="btn btn-warning ms-2 btn-sm text-dark" 
                                data-bs-toggle="popover" 
                                data-bs-placement="right" 
                                data-bs-custom-class="custom-popover" 
                                data-bs-title="Record starting date" 
                                data-bs-content=
                                    "Insert the recorded date of the seismic record. If you don't specify a value, the default value 
                                    '1970-01-01' is going to be used."
                                >?
                            </button> 
                            starting date:
                        </label>
                    </div>

                    

                    <div class="col-lg-3 col-6 text-start">
                        <input type="date" class="form-control" id="date-input" name="date-input">
                    </div>

                    

                    <div class="col-lg-3 col-6 text-start">
                        <label for="time" class="d-inline">
                            <button  
                                type="button" 
                                class="btn btn-warning ms-2 btn-sm text-dark" 
                                data-bs-toggle="popover" 
                                data-bs-placement="right" 
                                data-bs-custom-class="custom-popover" 
                                data-bs-title="time" 
                                data-bs-content=
                                    "Insert the recorded time of the seismic record. If you don't specify a value, the default value 
                                    '00:00:00' is going to be used.""
                                >?
                            </button> 
                            Starting time:
                        </label>
                    </div>

                    <div class="col-lg-3 col-6 text-start">
                        <input type="time" class="form-control" id="time-input" name="time-input">
                    </div>

                

                    <div class="col-lg-3 col-6 text-start">
                        <label for="station" class="d-inline">
                            <button  
                                type="button" 
                                class="btn btn-warning ms-2 btn-sm text-dark" 
                                data-bs-toggle="popover" 
                                data-bs-placement="right" 
                                data-bs-custom-class="custom-popover" 
                                data-bs-title="Station name" 
                                data-bs-content=
                                    "Insert the station name of your records. If empty, no station information is going to be inserted into 
                                    the mseed file."
                                >?
                            </button> 
                            Station name:
                        </label>
                    </div>

                    <div class="col-lg-3 col-6 text-start">
                        <input type="text" class="form-control d-inline" id="station-input" name="station-input" placeholder="e.g. SEIS" regex="^[A-Za-z0-9]{4}$">
                    </div>

                    <div class="w-100 d-none d-lg-block"></div>

                    <div class="col-lg-3 col-md-6 col-6 text-start">
                        <label for="fs">
                            <button  
                                type="button" 
                                class="btn btn-warning ms-2 btn-sm text-dark" 
                                data-bs-toggle="popover" 
                                data-bs-placement="right" 
                                data-bs-custom-class="custom-popover" 
                                data-bs-title="Record commponents" 
                                data-bs-content=
                                    "Fill in the name of each component in the record, in the same row as the uploaded file columns."
                                >?
                            </button> 
                            Channels *:
                        </label>
                    </div>

            
                    <div class="col-lg-9 col-md-6 col-12 text-center">
                        <div class="row justify-content-center">
                            <div class="col text-start">
                                <label for="hor1"> Channel 1</label><br>
                                <select class="form-select" aria-label="component 1" id="compo1" name="compo1">
                                    <option value="not-selected" selected>select channel</option>
                                    <option value="E">E</option>
                                    <option value="N">N</option>
                                    <option value="Z">Z</option>
                                </select>
                            </div>
                            <div class="col text-start">
                                <label for="hor2">Channel 2</label><br>
                                <select class="form-select" aria-label="component 2" id="compo2" name="compo2">
                                    <option value="not-selected" selected>select channel</option>
                                    <option value="E">E</option>
                                    <option value="N">N</option>
                                    <option value="Z">Z</option>
                                </select>
                            </div>
                            <div class="col text-start">
                                <label for="compo3">Channel 3</label><br>
                                <select class="form-select" aria-label="component 3" id="compo3" name="compo3">
                                    <option value="not-selected" selected>select channel</option>
                                    <option value="E">E</option>
                                    <option value="N">N</option>
                                    <option value="Z">Z</option>
                                </select>
                            </div>
                        </div>
                    </div>

        
                    
                    
                    
                    <div class="col-6 col-md-6 col-lg-3 text-start">
                        <label for="fs">
                            <button  
                                type="button" 
                                class="btn btn-warning ms-2 btn-sm text-dark" 
                                data-bs-toggle="popover" 
                                data-bs-placement="right" 
                                data-bs-custom-class="custom-popover" 
                                data-bs-title="Record sampling frequency/sample distance" 
                                data-bs-content=
                                    "Select one of the two parameters: sampling frequency fs (Hz) or sample distance dt (sec) and insert 
                                    a value for it. You cannot leave this empty!"
                                >?
                            </button> 
                            fs/dt *:
                        </label>
                    </div>

                
                    <div class="col-12 col-md-6 col-lg-9">
                        <div class="row justify-content-between">
                            <div class="col">
                                
                                <div class="btn-group w-100" role="group" aria-label="Basic radio toggle button group">
                                    <input type="radio" class="btn-check" name="btnradio" id="fs-radio" autocomplete="off" checked>
                                    <label class="btn btn-outline-primary" for="fs-radio">fs (Hz)</label>        
                                    <input type="radio" class="btn-check" name="btnradio" id="dt-radio" autocomplete="off">
                                    <label class="btn btn-outline-primary" for="dt-radio">dt (sec)</label>
                                </div>
                            </div>

                            <div class="col">
                                <input type="number" class="form-control" style="width:100%" id="parameter-value" name="parameter-value" required>
                            </div>
                        </div>
                    </div>


                    


                    
                </div>
                <div class="row justify-content-center align-items-center my-4">
                    <div class="col-8 text-center">
                        <p class="fs-5">For more information about these options click <a target="_blank" href="https://docs.obspy.org/packages/autogen/obspy.core.trace.Stats.html" class="text-center link-info">here</a></p>
                    </div>
                </div>

                <p class="text-start fs-6 text-secondary my-5">The fields denoted by an asterisc (*) must be filled in </p>
                <div class="col-12 mt-5 text-center">
                    <button class="btn btn-success btn-lg" id="submit-seismic-params-button">convert to mseed</button>
                </div>
            </fieldset>
        </div>
    </div>
</section>

    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="/static/js/ascii-to-mseed.js"></script>
{% endblock %}
