
{% extends 'base-interactive-tools.html' %}

{% block tool_title_description %}
    Plot the ray-paths between the stations and the earthquakes
{% endblock %}

{% block tool_user_guide %}
    <p>
        Analyze the Fourier Spectra within a specified seismic record window. Begin by
        uploading a seismic data file. Then, utilize the <i>signal left side</i> slider and
        the <i>window length</i> slider to manipulate the position and length of the signal
        window (highlighted in red). This will allow you to precisely define the
        section for which you want to compute the Fourier Spectra. For added functionality,
        you can use the <kbd>add+</kbd> button to compute the Fourier Spectra for
        a noise window (indicated in blue). By adjusting the <i>Noise window right side</i>
        slider, you can align the right side of the noise window with the signal
        window. These two windows will share the same duration or length. To calculate the Fourier
        spectra for the entire time series, simply click the <kbd>apply</kbd> button,
        to make the length of the signal window cover all the time series.
    </p>
    <p>
        Once you're prepared, select the <kbd>Compute Fourier</kbd> button to initiate the computation of the Fourier Spectra at the bottom. 
        Optionally, check the <i>Compute HVSR</i> checkbox to calculate the HVSR curve in addition to the 
        Fourier Spectra. Make sure to select the vertical component of your records to appropriately compute the HVSR curve. 
        The resulting Fourier Spectra and the HVSR curve will be accessible
        under the <i>Fourier</i> and the <i>HVSR</i> tab at the top, respectively. There, you can opt to
        download either the graphical representation or the data in ASCII format.
    </p>
    <p>
        According to the Fourier Spectra calculation you can check the script used <a target="_blank" href="{{ url_for('static', filename='static-files/fourier_spectra_calculation_script.txt') }}">here</a>
    </p>
    <p>
        According to the HVSR curve, when there are two horizontal components, it is determined by dividing the average horizontal Fourier Spectra by the Fourier 
        Spectra from the vertical component. This average horizontal spectra is computed as the square root of half the sum of the squares of the two horizontal 
        Fourier spectra, i.e., <code>sqrt((hor1^2 + hor2^2) / 2)</code>. When there's one horizontal component and one vertical component, the HVSR curve is simply the result 
        of dividing the horizontal Fourier spectra by the vertical spectra.
    </p>
{% endblock %}


{% block tool_body %}
    <p class="text-center mt-5 mb-3">
        Upload the input file
    </p>
    <div class="text-center my-4">
        <button class="btn btn-outline-info" id="upload-file-button">Upload file</button>
    </div>
    <input type="file" id="upload-file-input" value="upload-file-input" name="upload-file-input" style="display: none;">
    <p class="text-center mt-5 mb-3">
        Link the file columns with the stations and the earthquakes coordinates
    </p>
    <div class="row justify-content-center align-items-center fs-6">
        <div class="col">
            <div>
                <label for="latstation" class="form-label">Station Latitude</label>
                <select class="form-select" aria-label="Default select example" id="latstation" name="latstation">
                    <option selected>Select Column</option>
                </select>
            </div>
        </div>
        <div class="col">
            <div>
                <label for="lonstation" class="form-label">Station Longitude</label>
                <select class="form-select" aria-label="Default select example" id="lonstation" name="lonstation">
                    <option selected>Select Column</option>
                </select>
            </div>
        </div>
        <div class="col">
            <div>
                <label for="latearth" class="form-label">Earthquake Latitude</label>
                <select class="form-select" aria-label="Default select example" id="latearth" name="latearth">
                    <option selected>Select Column</option>
                </select>
            </div>
        </div>
        <div class="col">
            <div>
                <label for="lonearth" class="form-label">Earthquake Longitude</label>
                <select class="form-select" aria-label="Default select example" id="lonearth" name="lonearth">
                    <option selected>Select Column</option>
                </select>
            </div>
        </div>
    </div>
    <div class="text-center">
        <button class="btn btn-dark my-5" id="button-plot" type="submit">Plot Data</button>
    </div>

    <div class="row justify-content-center align-items-stretch fs-6">
        <div class="col-8">
            <div id="graph-area">

            </div>
        </div>
        <div class="col-3">
           
            <div id="style-area"  class="border border-1 border-secondary p-2"> 
                <div>
                    <p class="fs-5 text-dark text-center fw-semibold my-3">Style Raypath Lines</p>
                    <div class="row justify-content-center">
                        <div class="col-4">
                            <div class="mb-3">
                                <label for="line-color" class="form-label">Color</label>
                                <input type="color" class="form-control" id="line-color">
                            </div>
                            <div class="mb-3">
                                <label for="line-width" class="form-label">Width</label>
                                <input type="number" class="form-control" id="line-width" min="0" max="20">
                            </div>
                            <div class="mb-3">
                                <label for="line-opacity" class="form-label">Opacity</label>
                                <input type="number" class="form-control" id="line-opacity" min="0" max="100">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <p class="fs-5 text-dark text-center fw-semibold mt-5 mb-3">Style Raypath Shapes</p>
                    <ul class="nav nav-pills mb-3" id="station-earthquake-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="pills-station-tab" data-bs-toggle="pill" data-bs-target="#pills-station" type="button" role="tab" aria-controls="pills-station" aria-selected="true">station</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-earthquake-tab" data-bs-toggle="pill" data-bs-target="#pills-earthquake" type="button" role="tab" aria-controls="pills-earthquake" aria-selected="false">earthquake</button>
                        </li>
                      </ul>
                      <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show active" id="pills-station" role="tabpanel" aria-labelledby="pills-station-tab" tabindex="0">
                            <div class="row justify-content-center">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label for="marker-color" class="form-label">Color</label>
                                        <input type="color" class="form-control" id="station-marker-color" value="#bc131f">
                                    </div>
                                    <div class="mb-3">
                                        <label for="marker-size" class="form-label">Size</label>
                                        <input type="number" class="form-control" id="station-marker-size" min="0" max="100" value="6">
                                    </div>
                                    <div class="mb-3">
                                        <label for="marker-opacity" class="form-label">Opacity</label>
                                        <input type="number" class="form-control" id="station-marker-opacity" min="0" max="100" value="100">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="pills-earthquake" role="tabpanel" aria-labelledby="pills-earthquake-tab" tabindex="0">
                            <div class="row justify-content-center">
                                <div class="col-4">
                                    <div class="mb-3">
                                        <label for="marker-color" class="form-label">Color</label>
                                        <input type="color" class="form-control" id="earthquake-marker-color" value="#0000ff">
                                    </div>
                                    <div class="mb-3">
                                        <label for="marker-size" class="form-label">Size</label>
                                        <input type="number" class="form-control" id="earthquake-marker-size" min="0" max="100" value="10">
                                    </div>
                                    <div class="mb-3">
                                        <label for="marker-opacity" class="form-label">Opacity</label>
                                        <input type="number" class="form-control" id="earthquake-marker-opacity" min="0" max="100" value="100">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center">
                <button class="btn btn-dark"  id="button-update-styles">Save</button>
            </div>
        </div>
    </div>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="{{ url_for('static', filename='js/raypaths.js') }}"></script>
{% endblock %}